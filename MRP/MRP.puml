@startuml
title Media Ratings Platform

package "Presentation" {
  [UserHandler\n---\nhandleRegister()\nhandleLogin()\nhandleUserProfile()\nhandleUserRatings()\nhandleUserFavorites()\nhandleUserStatistics()] as UserHandler

  [MediaHandler\n---\nhandleGetAllMedia()\nhandleGetMedia()\nhandleCreateMedia()\nhandleUpdateMedia()\nhandleDeleteMedia()\nhandleSearchMedia()\nhandleRateMedia()\nhandleFavoriteMedia()] as MediaHandler

  [RatingHandler\n---\nhandleLikeRating()\nhandleUpdateRating()\nhandleConfirmRating()] as RatingHandler
}

package "Application" {
  [UserService\n---\nregisterUser()\nloginUser()\ngetUserProfile()\ngetUserRatings()\ngetUserFavorites()\ngetUserStatistics()\nupdateUserProfile()] as UserService

  [MediaService\n---\ngetAllMedia()\ngetMediaById()\ncreateMedia()\nupdateMedia()\ndeleteMedia()\nsearchMedia()\ngetMediaByCreator()] as MediaService

  [RatingService\n---\ncreateRating()\nupdateRating()\nlikeRating()\nconfirmRating()\ngetRatingById()] as RatingService
}

package "Domain" {
  [User\n---\nid\nusername\npasswordHash\nfavoriteGenre\ncreatedAt] as User

  [UserStatistics\n---\nuserId\nactivityPoints] as UserStatistics

  [Media\n---\nid\ntype\ntitle\ndescription\nreleaseYear\nageRestriction\ncreatorId] as Media

  [Genre\n---\ngenreId\nname] as Genre

  [Rating\n---\nid\nmediaId\nuserId\nstars\ncomment\nconfirmed\ncreatedAt] as Rating
}

package "Infrastructure" {
  [UserRepository\n---\nsave()\ngetById()\ngetByUsername()\nupdateUser()\ndeleteById()] as UserRepository

  [UserStatisticsRepository\n---\ngetByUserId()\nupdateActivityPoints()] as UserStatisticsRepository

  [MediaRepository\n---\nsave()\ngetById()\ngetAllMedia()\nsearchMedia()\ndeleteById()\naddGenres()\nremoveGenres()\ngetMediaGenres()] as MediaRepository

  [GenreRepository\n---\ngetAll()\ngetById()\ngetByName()\ncreate()] as GenreRepository

  [RatingRepository\n---\nsave()\ngetById()\ngetByMediaId()\ngetByUserId()\nupdate()\ndelete()] as RatingRepository

  [RatingLikeRepository\n---\naddLike()\nremoveLike()\ngetLikesCount()\nhasUserLiked()] as RatingLikeRepository

  [FavoriteRepository\n---\naddFavorite()\nremoveFavorite()\ngetUserFavorites()\nisFavorite()] as FavoriteRepository

  [TokenRepository\n---\ncreateToken()\ngetUserIdFromToken()\ndeleteToken()\nupdateLastUsed()] as TokenRepository
}

database "database" {
  [users\n---\nid\nusername\npassword_hash\nfavorite_genre\ncreated_at]

  [genres\n---\ngenre_id\nname]

  [media\n---\nid\ntype\ntitle\ndescription\nrelease_year\nage_restriction\ncreator_id]

  [media_genres\n---\nmedia_id\ngenre_id]

  [ratings\n---\nid\nmedia_id\nuser_id\nstars\ncomment\nconfirmed\ncreated_at]

  [rating_likes\n---\nrating_id\nuser_id]

  [favorites\n---\nuser_id\nmedia_id]

  [tokens\n---\nid\ntoken\nuser_id\ncreated_at\nexpires_at\nlast_used_at]
}

' Presentation -> Application flows
UserHandler --> UserService
MediaHandler --> MediaService
RatingHandler --> RatingService

' Application -> Domain flows
UserService --> User
UserService --> UserStatistics
MediaService --> Media
MediaService --> Genre
RatingService --> Rating

' Application -> Infrastructure flows
UserService --> UserRepository
UserService --> UserStatisticsRepository
UserService --> FavoriteRepository
UserService --> TokenRepository

MediaService --> MediaRepository
MediaService --> GenreRepository

RatingService --> RatingRepository
RatingService --> RatingLikeRepository

' Infrastructure -> Database flows
UserRepository --> users
UserStatisticsRepository --> user_statistics
MediaRepository --> media
GenreRepository --> genres
MediaRepository --> media_genres
RatingRepository --> ratings
RatingLikeRepository --> rating_likes
FavoriteRepository --> favorites
TokenRepository --> tokens
@enduml