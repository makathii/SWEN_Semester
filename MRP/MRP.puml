@startuml
title Media Ratings Platform – Full Layered Architecture

package "Presentation Layer" {

  class UserHandler {
    handleRegister()
    handleLogin()
    handleUserProfile()
    handleUserFavorites()
    handleRecommendations()
  }

  class MediaHandler {
    handleGetAllMedia()
    handleGetMedia()
    handleCreateMedia()
    handleUpdateMedia()
    handleDeleteMedia()
    handleSearchMedia()
  }

  class RatingHandler {
    handleRateMedia()
    handleUpdateRating()
    handleConfirmRating()
    handleDeleteRating()
    handleLikeRating()
    handleGetRating()
  }

  class LeaderboardHandler {
  handleMostActiveUsers()
  handleTopRatedMedia()
  handleMostLikedRatings()
  handleTrendingGenres()
  }
}

package "Application / Service Layer" {

  class UserService {
  registerUser()
  loginUser()
  updateUser()
  getUserById()
  }

  class MediaService{
  getAllMedia()
  getMediaById()
  createMedia()
  updateMedia()
  deleteMedia()
  searchMedia()
  getMediaByCreator()
  }

  class FavoriteService {
  addFavorite()
  removeFavorite()
  getUserFavorites()
  }

  class RatingService {
  rateMedia()
  getPublicRating()
  getRatingsByUser()
  updateRating()
  confirmRating()
  deleteRating()
  likeRating()
  getRatingLikeCount()
  getRatingById()
  }

  class RecommendationService {
  getGenreBasedRecommendations()
  getContentBasedRecommendations()
  }

  class LeaderboardService {
  getMostActiveUsers()
  getTopRatedMedia()
  getMostLikedRatings()
  getTrendingGenres()
  }
}

package "Domain Layer" {

  class User {
  id
  username
  passwordHash
  favoriteGenre
  createdAt
  }

  class Media {
  id
  type
  title
  description
  releaseYear
  ageRestriction
  creatorId
  genres
  }

  class Rating {
  id
  mediaId
  userId
  stars
  comment
  confirmed
  createdAt
  }

  class Favorite {
  userId
  mediaId
  }

  class LeaderboardEntry
  class TopRatedMedia
  class MostLikedRating
}

package "Infrastructure Layer" {

  class UserRepository
  class MediaRepository
  class RatingRepository
  class FavoriteRepository
  class TokenRepository
  class LeaderboardRepository
}

database "Database" {

  class users <<table>>
  class media <<table>>
  class ratings <<table>>
  class favorites <<table>>
  class rating_likes <<table>>
  class tokens <<table>>
  class media_genres <<table>>

}


' Presentation → Services
UserHandler --> UserService
UserHandler --> FavoriteService
UserHandler --> RecommendationService

MediaHandler --> MediaService

RatingHandler --> RatingService

LeaderboardHandler --> LeaderboardService

' Services → Domain
UserService --> User
MediaService --> Media
RatingService --> Rating
FavoriteService --> Favorite
RecommendationService --> Media
LeaderboardService --> LeaderboardEntry
LeaderboardService --> TopRatedMedia
LeaderboardService --> MostLikedRating

' Services → Infrastructure
UserService --> UserRepository
UserService --> TokenRepository

MediaService --> MediaRepository

FavoriteService --> FavoriteRepository
FavoriteService --> UserRepository
FavoriteService --> MediaRepository

RatingService --> RatingRepository
RatingService --> MediaRepository
RatingService --> UserRepository

RecommendationService --> MediaRepository
RecommendationService --> RatingRepository
RecommendationService --> FavoriteRepository

LeaderboardService --> LeaderboardRepository

' Infrastructure → Database
UserRepository --> users
MediaRepository --> media
MediaRepository --> media_genres
RatingRepository --> ratings
FavoriteRepository --> favorites
RatingRepository --> rating_likes
TokenRepository --> tokens

@enduml
